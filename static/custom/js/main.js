let parsedPriceData;
let organizedTickerData;

// Borrowed from user Bergi on StackOverflow 
// https://stackoverflow.com/questions/11786995/create-object-on-the-fly-from-csv
function parsePriceCSV(input) {
    var rows = input.split(/\r?\n/);
    var keys = rows.shift().split(",");
    return rows.map(function(row) {
        return row.split(",").reduce(function(map, val, i) {
            map[keys[i]] = val;
            return map;
        }, {});
    });
}

// Generated by ChatGPT 3.5 and tweaked to our purposes (e.g. filtering just month from the full price date)
function convertData(inputArr) {
    let output = {};
    
    inputArr.forEach(item => {
        const { Index, ticker, date, ...rest } = item;
        
        if (!output[ticker]) {
            output[ticker] = {
                priceHistory: {}
            };
        }
        
        output[ticker].priceHistory[parseInt(date.slice(5,7))] = rest;
    });
    
    return output;
}

// grab stock data and process it
fetch('Resourses/stockdata.csv')
    .then(response => response.text())
    .then(function(table) {
        
        //convert csv array to more presentable 
        organizedTickerData = convertData(parsePriceCSV(table));
        console.log(organizedTickerData);

        console.log(organizedTickerData.AAPL.priceHistory[2].open)
    });